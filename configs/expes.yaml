data_path:  data/
result_path:  result/
dataset:  UKDALE
name_model:  NILMFormer
sampling_rate:  1min
window_size: 128
list_exo_variables:
  - minute
  - hour
  - dow
  - month

power_scaling_type:  MaxScaling
appliance_scaling_type:  MaxScaling

batch_size:  128
epochs:  25
p_es:  null
p_rlr:  3
n_warmup_epochs:  3
scheduler_type:  cosine_warmup   # cosine_warmup (recommended) / plateau
rlr_min_lr:  1e-6

device:  auto          # auto / cuda / mps / cpu
accumulate_grad_batches: 1

num_workers: 8
prefetch_factor: 4

train_num_crops: 4
train_crop_ratio: 0.75
train_crop_event_bias: 0.8

# EAEC Related Parameters
p_es_eaec:  null
p_rlr_eaec:  5
n_warmup_epochs_eaec:  3
warmup_type_eaec:  linear
neg_penalty_weight_eaec: 0.02
rlr_factor_eaec: 0.5
rlr_min_lr_eaec: 1e-6
gradient_clip_val_eaec: 1.0
gate_cls_weight_eaec: 1.0
gate_window_weight_eaec: 0.5
gate_focal_gamma_eaec: 2.0

# seq2subseq: Only supervise center region of output to reduce boundary effects
# 0.5 means supervise middle 50% (e.g., input 128 -> supervise middle 64 points)
# Inference will also only use center predictions, discarding edges
output_ratio: 0.5

# Zero-run penalty for target=0 segments
state_zero_penalty_weight: 0.1
state_zero_kernel: 48
state_zero_ratio: 0.9

postprocess_min_on_steps: 3

off_high_agg_penalty_weight: 0.3

# ============== Loss function hyperparameters (auto-adjusted by appliance type) ==============
# These are default values and will be overridden by _configure_nilm_loss_hyperparams based on appliance type
#
# Supported appliance types:
#   - sparse_high_power:    sparse high-power appliances (e.g., Kettle, Microwave)
#   - frequent_switching:   frequently switching appliances (e.g., Fridge)
#   - long_cycle:           long-cycle appliances (e.g., WashingMachine, Dishwasher)
#   - always_on:            always-on appliances
#   - sparse_medium_power:  sparse medium-power appliances
#
# 使用 AdaptiveDeviceLoss (multi_nilm) - 自动根据设备类型调整参数
loss_type: multi_nilm

# ===== OFF false-positive penalty (mild, prevents learning all-zero output) =====
# lambda_off_hard: OFF-state hard constraint weight (lower!)
loss_lambda_off_hard: 0.1

# off_margin: power tolerance margin in OFF state (after normalization), allowing small noise
loss_off_margin: 0.02

# ===== ON missed-detection penalty (critical! prevents all-zero output) =====
# lambda_on_recall: ON missed-detection penalty weight, penalizing too-low outputs when ON
loss_lambda_on_recall: 0.3

# on_recall_margin: minimum fraction of target output when ON
loss_on_recall_margin: 0.5

# ===== Gate classification (mild setting) =====
# lambda_gate_cls: gate classification loss weight (lower!)
loss_lambda_gate_cls: 0.1

# gate_focal_gamma: Focal Loss gamma parameter
loss_gate_focal_gamma: 2.0

postprocess_gate_avg_threshold: 0.25
postprocess_gate_max_threshold: 0.5

postprocess_per_device:
  Microwave:
    postprocess_threshold: 15
    postprocess_min_on_steps: 1
  Fridge:
    postprocess_threshold: 15
    postprocess_min_on_steps: 2
