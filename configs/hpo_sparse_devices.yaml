# ============================================================
# HPO search space - Optimized for sparse high-power devices (Microwave, Kettle)
# Features: higher alpha_on, lower alpha_off, higher gate_floor
# ============================================================
NILMFormer:
  # Sampling rate and window - locked to speed up search
  sampling_rate:
    type: categorical
    choices: ["1min"]
  window_size:
    type: categorical
    choices: [128]
  # Learning rate
  lr:
    type: loguniform
    low: 5e-5
    high: 3e-4
  wd:
    type: loguniform
    low: 1e-5
    high: 1e-2
  # Model architecture - sparse devices don't need large models
  d_model:
    type: int
    low: 64
    high: 128
    step: 32
  n_encoder_layers:
    type: int
    low: 2
    high: 4
    step: 1
  n_head:
    type: int
    low: 2
    high: 4
    step: 2
  dp_rate:
    type: uniform
    low: 0.1
    high: 0.3
  pffn_ratio:
    type: int
    low: 2
    high: 4
    step: 1
  kernel_size:
    type: int
    low: 3
    high: 7
    step: 2
  kernel_size_head:
    type: int
    low: 1
    high: 3
    step: 2

  # ===== Key loss params - optimized for sparse devices =====
  # ON-state weight - significantly increased to detect sparse events
  loss_alpha_on:
    type: loguniform
    low: 6.0
    high: 18.0
  # OFF-state weight - significantly reduced to avoid over-penalization
  loss_alpha_off:
    type: loguniform
    low: 0.05
    high: 0.5
  # Recall weight - increased to reduce missed detections
  loss_lambda_on_recall:
    type: loguniform
    low: 2.0
    high: 8.0
  loss_on_recall_margin:
    type: uniform
    low: 0.85
    high: 0.98
  # Energy regression
  loss_lambda_energy:
    type: loguniform
    low: 0.05
    high: 0.5
  # Sparsity penalty - reduced to allow more activations
  loss_lambda_sparse:
    type: loguniform
    low: 0.0001
    high: 0.003
  # OFF hard constraint - reduced
  loss_lambda_off_hard:
    type: loguniform
    low: 0.001
    high: 0.02

  # ===== Gate params - critical! =====
  # Gate sharpness
  gate_soft_scale:
    type: uniform
    low: 1.5
    high: 4.0
  # Gate floor - increased to allow more detections
  gate_floor:
    type: loguniform
    low: 0.015
    high: 0.1
  # Output ratio
  output_ratio:
    type: uniform
    low: 0.5
    high: 0.75
