# ============================================================
# HPO搜索空间 - 专为稀疏高功率设备优化 (Microwave, Kettle)
# 特点: 更高的alpha_on，更低的alpha_off，更高的gate_floor
# ============================================================
NILMFormer:
  # 采样率和窗口 - 锁定以加速搜索
  sampling_rate:
    type: categorical
    choices: ["1min"]
  window_size:
    type: categorical
    choices: [128]
  # 学习率
  lr:
    type: loguniform
    low: 5e-5
    high: 3e-4
  wd:
    type: loguniform
    low: 1e-5
    high: 1e-2
  # 模型架构 - 稀疏设备不需要太大模型
  d_model:
    type: int
    low: 64
    high: 128
    step: 32
  n_encoder_layers:
    type: int
    low: 2
    high: 4
    step: 1
  n_head:
    type: int
    low: 2
    high: 4
    step: 2
  dp_rate:
    type: uniform
    low: 0.1
    high: 0.3
  pffn_ratio:
    type: int
    low: 2
    high: 4
    step: 1
  kernel_size:
    type: int
    low: 3
    high: 7
    step: 2
  kernel_size_head:
    type: int
    low: 1
    high: 3
    step: 2

  # ===== 关键损失参数 - 针对稀疏设备优化 =====
  # ON状态权重 - 大幅提高以检测稀疏事件
  loss_alpha_on:
    type: loguniform
    low: 6.0
    high: 18.0
  # OFF状态权重 - 大幅降低以减少过度惩罚
  loss_alpha_off:
    type: loguniform
    low: 0.05
    high: 0.5
  # 召回权重 - 提高以减少漏检
  loss_lambda_on_recall:
    type: loguniform
    low: 2.0
    high: 8.0
  loss_on_recall_margin:
    type: uniform
    low: 0.85
    high: 0.98
  # 能量回归
  loss_lambda_energy:
    type: loguniform
    low: 0.05
    high: 0.5
  # 稀疏惩罚 - 降低以允许更多激活
  loss_lambda_sparse:
    type: loguniform
    low: 0.0001
    high: 0.003
  # OFF硬约束 - 降低
  loss_lambda_off_hard:
    type: loguniform
    low: 0.001
    high: 0.02

  # ===== Gate参数 - 关键! =====
  # Gate锐度
  gate_soft_scale:
    type: uniform
    low: 1.5
    high: 4.0
  # Gate下限 - 提高以允许更多检测
  gate_floor:
    type: loguniform
    low: 0.015
    high: 0.1
  # 输出比例
  output_ratio:
    type: uniform
    low: 0.5
    high: 0.75
