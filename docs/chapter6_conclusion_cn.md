# 第六章 总结

非侵入式负荷监测作为智能电网和建筑能源管理的关键技术，通过分析建筑总电表的聚合功率信号来推断各电器设备的独立功耗，无需在每个设备上安装专用计量表即可实现细粒度的用电监测。这一技术对于提升能源效率、促进用户节能行为改变、支撑电网需求响应具有重要的应用价值。然而，多设备联合分解场景中存在的梯度冲突、领域知识缺失和预测塌缩三大核心挑战，严重制约了现有方法的实际性能。本文针对这些挑战，提出了CondiNILMformer方法，通过条件特征调制机制、多层级自适应架构和设备感知损失函数三项相互配合的技术创新，实现了对现有方法的显著超越。

本文的第一项核心贡献是基于FiLM的条件特征调制机制。现有端到端深度学习方法试图完全从原始功率数据中自动学习特征表示，忽视了电气工程领域数十年积累的负荷特性分析方法。本文首次将Feature-wise Linear Modulation机制引入NILM任务，设计了包含5维电气特征和8维频域特征的13维条件向量。电气特征包括均值功率、功率标准差、均方根功率、峰值功率和峰值因数，这些特征从不同角度刻画负荷的时域统计特性；频域特征通过傅里叶变换将功率信号分解为8个频带的幅度，捕捉设备的周期性运行模式和谐波特征。通过可学习的设备嵌入与条件特征的拼接和MLP映射，模型能够为每个目标设备生成独立的缩放和平移参数，根据当前输入的电气特性动态调整网络的特征处理方式。这一设计使模型能够利用经过实践验证的负荷判别知识，提高了样本效率和可解释性，消融实验表明该机制对整体F1分数贡献约2.7%的提升。

本文的第二项核心贡献是多层级设备自适应架构。原始NILMformer采用完全共享参数的设计，缺乏针对设备差异的处理机制，导致不同设备对共享参数的梯度更新方向相互矛盾。本文设计了"共享与专用相结合"的层次化参数共享策略来解决这一问题。在底层，多尺度膨胀卷积嵌入和Transformer编码器在所有设备间共享，学习通用的功率序列表示；膨胀率为1、2、4、8的四层卷积提供了约60个时间步的有效感受野，配合对角线掩码自注意力机制禁止自关注以强制模型学习上下文关系。在中层，为每个目标设备引入轻量级瓶颈结构适配器，通过小权重残差连接与共享特征融合，在保持共享表示的基础上引入设备特异性调整，适配器参数量仅占编码器的约5%。在顶层，根据设备电气特性将设备划分为稀疏高功率型、周期型、长周期型等类别，同类设备共享输出头参数以利用相似性，不同类型使用独立参数以适应差异。软门控融合机制是该架构的重要组成部分，它将功率预测分解为功率估计和状态检测两个子任务，通过包含下界、缩放因子和偏置的参数化sigmoid变换融合两者输出，不同设备类型配置不同的门控参数。消融实验表明软门控机制贡献约5.4%的F1分数提升，是稀疏设备检测能力改进的关键因素。

本文的第三项核心贡献是设备感知的复合损失函数。标准回归损失函数对所有时间点和所有设备一视同仁，未能考虑NILM任务中普遍存在的类别不平衡问题，导致模型倾向于输出接近零的预测以最小化整体损失。本文设计的六分量复合损失函数从多个角度约束模型学习：主回归损失通过软阈值函数区分开启和关闭时段并分别加权，解决类别不平衡问题；全局稳定损失提供不加权的基线监督信号，确保训练初期的稳定性；ON召回损失专门惩罚对开启时段的低估，防止预测塌缩；OFF误报损失惩罚关闭时段的高估，控制误报率；ON功率精度损失使用相对误差直接优化归一化分解误差指标；能量回归损失约束窗口内的总能量预测，确保能量守恒。更重要的是，本文提出了基于设备电气统计特征的参数自动推导机制，系统从训练数据计算每个设备的占空比、峰值功率、平均开启功率、功率变异系数和事件持续时间，根据这些统计量将设备自动分类并配置相应的损失参数，实现了"不同设备、不同优化策略"的精细化训练。配合损失函数层级、辅助惩罚层级和动态衰减层级构成的三重防塌缩机制，有效解决了稀疏设备训练中的预测塌缩问题。消融实验表明复合损失函数是性能提升的最关键因素，移除后F1分数下降6.8%，稀疏设备性能下降尤为显著。

在UK-DALE、REFIT和REDD三个公开NILM数据集上的系统实验全面验证了所提方法的有效性。UK-DALE数据集包含5个英国家庭2-4年的用电记录，是NILM领域最具影响力的基准数据集之一；REFIT数据集包含20个英国家庭两年的用电记录，提供了更丰富的家庭用电模式多样性；REDD数据集来自6个美国家庭，用于验证方法的跨地域泛化能力。实验采用住宅级别的数据划分确保训练集和测试集来自不同住宅，目标设备包括电水壶、微波炉、冰箱、洗衣机和洗碗机五种具有代表性的家用电器，涵盖了稀疏高功率、周期性和长周期多阶段等典型用电模式。

在UK-DALE主实验中，CondiNILMformer在13种基线方法中取得最优综合性能，相比原始NILMformer实现了MAE降低11.4%（从15.8降至14.0）、F1分数提升2.8%（从0.72提升至0.74）、召回率从0.79大幅提升至0.93的性能改进。逐设备分析揭示了方法的核心优势所在：对于稀疏高功率设备，电水壶的召回率从0.65提升至0.80，微波炉的召回率从0.58提升至0.67，有效解决了现有方法在稀疏设备上的漏检问题；对于周期性设备，冰箱在保持0.96高召回率的同时进一步降低了MAE和NDE，表明模型能够更准确地追踪压缩机的周期性功率波动；对于长周期设备，洗衣机和洗碗机的F1分数分别提升6.9%和4.1%。多设备联合训练与单设备独立训练的对比实验表明，联合训练在所有设备上均取得了优于或等于单设备训练的性能，验证了设备适配器和类型分组输出头设计能够有效缓解多任务学习中的梯度冲突问题。

跨数据集泛化实验进一步证明了方法的普适性。在REFIT数据集上，冰箱、洗衣机和洗碗机三种设备的平均MAE降低11.8%，平均F1分数提升5.7%，性能改进趋势与UK-DALE一致。在REDD数据集上，尽管数据记录时长较短且质量参差不齐，方法仍然取得了一致的性能改进，特别是在最具挑战性的微波炉设备上，召回率从0.51提升至0.58。这些结果表明方法不依赖于特定数据集的统计特性，具有良好的跨数据集和跨地域泛化能力。

消融实验系统分析了各创新组件的贡献及其交互效应。在完整模型的基础上依次移除各组件后，复合损失函数的贡献最大（F1下降6.8%），软门控机制次之（F1下降5.4%），FiLM条件调制（F1下降2.7%）、设备适配器（F1下降1.4%）和类型分组输出头（F1下降2.7%）也都有稳定贡献。更重要的是，组合消融实验揭示了各组件之间的正向协同效应：同时移除多个组件导致的性能下降大于各组件单独贡献之和，例如同时移除FiLM和复合损失导致F1下降12.2%，大于两者单独贡献之和的9.5%。这一结果验证了方法设计的系统性和完整性，条件调制提供的设备感知特征需要与设备感知损失函数协同工作才能发挥最大效果。

综上所述，本文提出的CondiNILMformer方法通过将领域知识与深度学习有机融合，为多设备非侵入式负荷监测任务提供了有效的解决方案。三项核心技术创新相互配合，形成了完整的方法论体系：FiLM条件调制机制桥接了电气工程经验与数据驱动学习，多层级自适应架构解决了多设备联合训练中的梯度冲突问题，设备感知复合损失函数应对了类别不平衡和预测塌缩问题。系统的实验评估在三个公开数据集上验证了方法的有效性和泛化能力，特别是在稀疏设备检测方面取得了显著改进。研究成果不仅推动了NILM领域的技术进步，也为其他需要融合领域知识的序列建模任务提供了可借鉴的方法论框架。
